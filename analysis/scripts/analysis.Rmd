---
title: "/s/ only data analysis"
author: "Grace Brown"
date: "April 16, 2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(lmerTest)
library(ggplot2)
library(MuMIn)
library(emmeans)

knitr::opts_knit$set(root.dir = "/Users/gracebrown/masc_perception_2spk")

# color-blind-friendly palette
cbPalette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442") 
cbPalette_2 <- c("#0072B2", "#D55E00", "#CC79A7")
cbPalette_3 <-c("#56B4E9", "#009E73", "#F0E442")
theme_set(theme_bw())
```

## Load Data

```{r load}
### DATA WRANGLING
## read messy dataset
df.sibilant <- read_csv("~/masc_perception_2spk/data/masc_2pk_pilot-merged.csv")
#df.survey <- read_csv("~/final-project-grace-brown/data/survey_post.csv")
#df.sibilant <- left_join(x=df.sibilant,y=df.survey,by="workerid")

# workerid EXCLUSION BY PRE-REGISTERED CRITERIA
## (1) audio attention check 
df.exclude_audio <- df.sibilant %>%  
  filter(trial_type == "audio-button-response", result == "incorrect") %>% 
  distinct(workerid)  # Keep only unique worker IDs

df.sibilant <- df.sibilant %>% 
  anti_join(df.exclude_audio, by = "workerid")

## (2) - responded to less than 85% of trials 
trial_num <- 72 # 108 total trials (36 sib + 36 control)
df.exclude_trialnum <- df.sibilant %>% 
  filter(!is.na(rt), trial_type == "audio-slider-response") %>% 
  count(workerid) %>% 
  filter(n / trial_num < 0.85) %>% 
  distinct(workerid)

df.sibilant <- df.sibilant %>% 
  anti_join(df.exclude_trialnum, by = "workerid")

# SET SRQ SCORES
## set blank items in `coding` to NA
df.sibilant$coding[df.sibilant$coding == ""] <- NA 

## create gender_trans and gender_link srq subscales in dataset 
df.sibilant$gender_trans <- ifelse(df.sibilant$trial_type == "html-slider-response" & 
                              is.na(df.sibilant$coding) == FALSE & 
                              df.sibilant$coding == "NEGATIVE",
                            as.numeric(df.sibilant$response)/100, NA)
df.sibilant$gender_link <- ifelse(df.sibilant$trial_type == "html-slider-response" & 
                             is.na(df.sibilant$coding) == FALSE & 
                             df.sibilant$coding == "POSITIVE",
                           (10000 - as.numeric(df.sibilant$response))/100, NA)

## calculate gender_trans and gender_link scores, merge with df.sibilant 
score_gender_link <- df.sibilant %>% 
  filter(!is.na(gender_link)) %>% 
  group_by(workerid) %>% 
  summarize("score_link" = sum(gender_link))
df.sibilant <- merge(df.sibilant, score_gender_link, by = "workerid", all.x = TRUE)
score_gender_trans <- df.sibilant %>% 
  filter(!is.na(gender_trans)) %>% 
  group_by(workerid) %>% 
  summarize("score_trans" = sum(gender_trans))
df.sibilant <- merge(df.sibilant, score_gender_trans, by = "workerid", all.x = TRUE)

## calculate final srq score
df.sibilant <- df.sibilant %>% mutate("srq_score" = (score_trans+score_link)/13)

# SELECT TRIALS OF INTEREST AND RECODE VARIABLES OF INTEREST
## relabel speaker from numeric ID to letter ID
df.sibilant$spk <- recode(df.sibilant$spk, 
                       `246` = "A", 
                       `723` = "B") %>%
  as.factor() # set to factor
```

## Basic Summaries
### SKIPPED Demographic Data
```{r summaries}
gender_summary <- data %>% select(workerid,gender) %>% group_by(gender) %>% reframe("count" = n_distinct(workerid))
print(gender_summary)

age_summary <- data %>% filter(!is.na(age)==T) %>% summarize("min_age" = min(age), "mean_age" = mean(age), "max_age" = max(age), "sd_age" = sd(age))
print(age_summary)

region_summary <- data %>% select(workerid,region) %>% group_by(region) %>% reframe("count" = n_distinct(workerid))
print(region_summary)

edu_summary <- data %>% select(workerid,education) %>% group_by(education) %>% reframe("count" = n_distinct(workerid))
print(edu_summary)

political <- data %>% filter(trial_type == "survey-likert") %>% reframe("workerid" = workerid, "political" = response)
political$political <- str_replace(political$political, "\\{'Q0': ", "")
political$political <- str_replace(political$political, "\\}", "")
political$political <- political$political %>% na_if("''")
data <- left_join(x=data,y=political,by="workerid")

pol_summary <- political %>% select(workerid,political) %>% group_by(political) %>% reframe("count" = n_distinct(workerid))
print(pol_summary)
```


## SKIPPED Relable Speakers

```{r speakers}
## relable spk
data$spk[data$spk == 246] = "A"
data$spk[data$spk == 723] = "C"
data$spk[data$spk == 340] = "B"

### relabel sib conditions
data$sib_code[data$sib_code == "low"] = "backed"
data$sib_code[data$sib_code == "high"] = "fronted"
```


## Numeric Data

```{r summarize data}
### summarize numeric data 
df.numeric <- df.sibilant %>% 
  filter(!is.na(response)) %>% 
  filter(trial_type == "audio-slider-response") %>%
  group_by(spk) %>% 
  filter(spk == "A" | spk == "B") 

df.numeric$sib_code <- factor(df.numeric$sib_code, 
                              levels = c("control", 
                                         "low", 
                                         "mid", 
                                         "high"))
df.numeric$response <- as.double(df.numeric$response)

# SKIP ADD LOBANOV NORMALIZED PITCH MEASUREMENTS TO DATASET
exp_data <- exp_data %>% 
  group_by(spk) %>% 
  mutate(NC_norm_mean_f0 = (NC_pitAve_semi - mean(NC_pitAve_semi))/sd(NC_pitAve_semi),
         NC_norm_SD_f0 = (NC_pitSD_semi - mean(NC_pitSD_semi))/sd(NC_pitSD_semi),
         NC_norm_max_f0 = (NC_pitMax_semi - mean(NC_pitMax_semi))/sd(NC_pitMax_semi),
         NC_norm_min_f0 = (NC_pitMin_semi - mean(NC_pitMin_semi))/sd(NC_pitMin_semi),
         norm_mean_f0 = (pitAve_semi - mean(pitAve_semi))/sd(pitAve_semi),
         norm_SD_f0 = (pitSD_semi - mean(pitSD_semi))/sd(pitSD_semi),
         norm_max_f0 = (pitMax_semi - mean(pitMax_semi))/sd(pitMax_semi),
         norm_min_f0 = (pitMin_semi - mean(pitMin_semi))/sd(pitMin_semi))
```

### By Participant
```{r by_part}
#### by participant 
df.numeric %>% group_by(workerid) %>% summarize("min" = min(response), "mean" = mean(response), "max" = max(response))
df.numeric %>% group_by(workerid, spk) %>% summarize("min" = min(response), "mean" = mean(response), "max" = max(response))
```

### By Speaker (Ratings)
```{r by_spk}
#### by spk
exp_sub_1 <- subset(exp_data, select = -c(trial_index,workerid)) 
exp_summary_1 <- summarize(exp_sub_1, "mean"=mean(response_numeric/100), "var" = var(response_numeric/100), "sd" = sd(response_numeric/100))
print(exp_summary_1)
```

### By Speaker + Sib (Ratings)
```{r by_spk_sib}
#### by spk + sib 
exp_sub_2 <- subset(exp_data, select = -c(trial_index,triplet_id)) %>% group_by(sib_code, spk)
exp_summary_2 <- summarize(exp_sub_2, "mean"=mean(response_numeric/100), "var" = var(response_numeric/100), "sd" = sd(response_numeric/100))
print(exp_summary_2)
```

### Phonetics by Speaker
```{r by_phon}
#### phonetics by spk 
phon_spk <- exp_data %>% group_by(spk) %>% summarize("meanHz" = mean(pitAve_Hz), 
                                                     "pitSDHz" = mean(pitSD_Hz),
                                                     "meanSem" = mean(pitAve_semi), 
                                                     "pitSDSem" = mean(pitSD_semi),
                                                     "SR" = mean(speech_rate),
                                                     "s_dur" = mean(s_milliseconddur, na.rm = T),
                                                     "prop_creak" = mean(prop_creak))
print(phon_spk)
```

## Visualizations

### FROM PILOT
```{r}
#ACROSS SPEAKERS
ggplot(data = df.numeric,
       mapping = aes(x = sib_code,
                     y = response/100)) + 
  stat_summary(fun = "mean",
               geom = "bar",
               fill = "lightblue") + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") +
  scale_x_discrete(limits = c("control", "low", "mid", "high")) + 
  labs(x = "/s/ Condition",
       y = "Masculinity Rating")



#BY SPEAKERS
ggplot(data = df.numeric,
       mapping = aes(x = sib_code,
                     y = response/100)) + 
  stat_summary(fun = "mean",
               geom = "bar",
               fill = "lightblue") + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") +
  facet_grid(~spk) +
  scale_x_discrete(limits = c("control", "low", "mid", "high")) + 
  labs(x = "/s/ Condition",
       y = "Masculinity Rating")


#BY SPEAKERS & ITEM (IN PARTS)
df.numeric %>% filter(triplet_id < 8) %>%
ggplot(mapping = aes(x = sib_code,
                     y = response/100)) + 
  stat_summary(fun = "mean",
               geom = "bar",
               fill = "lightblue") + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") +
  facet_grid(triplet_id~spk) +
  scale_x_discrete(limits = c("control", "low", "mid", "high")) + 
  labs(x = "/s/ Condition",
       y = "Masculinity Rating")

df.numeric %>% filter(triplet_id > 7 & triplet_id < 16) %>%
  ggplot(mapping = aes(x = sib_code,
                     y = response/100)) + 
  stat_summary(fun = "mean",
               geom = "bar",
               fill = "lightblue") + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") +
  facet_grid(triplet_id~spk) +
  scale_x_discrete(limits = c("control", "low", "mid", "high")) + 
  labs(x = "/s/ Condition",
       y = "Masculinity Rating")

df.numeric %>% filter(triplet_id > 15) %>%
  ggplot(mapping = aes(x = sib_code,
                     y = response/100)) + 
  stat_summary(fun = "mean",
               geom = "bar",
               fill = "lightblue") + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange") +
  facet_grid(triplet_id~spk) +
  scale_x_discrete(limits = c("control", "low", "mid", "high")) + 
  labs(x = "/s/ Condition",
       y = "Masculinity Rating")
```


### General distribution of all ratings
```{r hist_all, echo=FALSE}
hist_all <- ggplot(exp_data, aes(x=response_numeric/100)) + 
  geom_histogram(bins=30) +
  xlab("Masculinity Rating") + 
  scale_fill_manual(values = cbPalette) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggsave(file="./analysis/main/Graphs/hist_all.pdf",width=7,height=4)
ggsave(file="./analysis/main/Graphs/hist_all.png",width=,height=4)
print(hist_all)
```

### Overall distribution of ratings by speaker
```{r hist_spk, echo=FALSE}
hist_by_spk <- ggplot(exp_data,aes(x=response_numeric/100))+
  geom_histogram(bins=30)+
  facet_grid(.~spk) +
  xlab("Masculinity Rating") +
  scale_fill_manual(values = cbPalette, name = "Speaker ID")
print(hist_by_spk)
ggsave(file="./analysis/main/Graphs/hist_spk.pdf",width=7,height=4)
ggsave(file="./analysis/main/Graphs/hist_spk.png",width=,height=4)
```

### Overall distribution of ratings by sib_code
```{r hist_by_sib, echo=FALSE}
hist_by_sib <- ggplot(exp_data,aes(x=response_numeric/100))+
  geom_histogram(bins=30)+
  facet_grid(.~sib_code) +
  xlab("Masculinity Rating")
print(hist_by_sib)
ggsave(file="./analysis/main/Graphs/hist_sib.pdf",width=7,height=4)
ggsave(file="./analysis/main/Graphs/hist_sib.png",width=,height=4)
```

### Overall distribution of ratings by sib_code and speaker
```{r hist_by_spk_sib, echo=FALSE}
hist_by_spk_sib <- ggplot(exp_data,aes(x=response_numeric/100))+
  geom_histogram(bins=20)+
  facet_grid(sib_code~spk) +
  xlab("Masculinity Rating")
print(hist_by_spk_sib)
ggsave(file="./analysis/main/Graphs/hist_spk_sib.pdf",width=7,height=4)
ggsave(file="./analysis/main/Graphs/hist_spk_sib.png",width=,height=4)
ggsave(file="./analysis/main/Graphs/hist_sib.png",width=,height=4)
```

### Overall distribution of ratings by triplet
```{r hist_by_trip, echo=FALSE}
hist_by_trip <- ggplot(exp_data,aes(x=response_numeric/100))+
  geom_histogram(bins=30)+
  facet_grid(.~triplet_id) + 
  xlab("Masculinity Rating")
print(hist_by_trip) 
```

### Ratings by triplet
```{r triplet_bar_pretty, echo=FALSE}
exp_data_1 <- filter(exp_data, triplet_id < 8) %>%
  group_by(triplet_id,spk) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))
exp_data_2 <- filter(exp_data, triplet_id > 7 & triplet_id < 16)  %>%
  group_by(triplet_id,spk) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))
exp_data_3 <- filter(exp_data, triplet_id > 15)  %>%
  group_by(triplet_id,spk) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))

exp_data_1$triplet_id <- as.factor(exp_data_1$triplet_id)
exp_data_2$triplet_id <- as.factor(exp_data_2$triplet_id)
exp_data_3$triplet_id <- as.factor(exp_data_3$triplet_id)

bar_1 <- ggplot(exp_data_1, aes(x = triplet_id, y = mean, fill = spk)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("Masculinity Rating") +
  xlab("Sentence Frame") +
  scale_fill_manual(values = cbPalette, name = "Speaker")
print(bar_1)
ggsave(file="./analysis/main/Graphs/bar_1.pdf",width=8,height=5)
ggsave(file="./analysis/main/Graphs/bar_1.png",width=8,height=5)

bar_2 <- ggplot(exp_data_2, aes(x = triplet_id, y = mean, fill = spk)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("Masculinity Rating") +
  xlab("Sentence Frame") +
  scale_fill_manual(values = cbPalette, name = "Speaker")
print(bar_2)
ggsave(file="./analysis/main/Graphs/bar_2.pdf",width=8,height=5)
ggsave(file="./analysis/main/Graphs/bar_2.png",width=8,height=5)

bar_3 <- ggplot(exp_data_3, aes(x = triplet_id, y = mean, fill = spk)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("Masculinity Rating") +
  xlab("Sentence Frame") +
  scale_fill_manual(values = cbPalette, name = "Speaker")
print(bar_3)
ggsave(file="./analysis/main/Graphs/bar_3.pdf",width=8,height=5)
ggsave(file="./analysis/main/Graphs/bar_3.png",width=8,height=5)
```

### Ratings by speaker
```{r spk_bar, echo=FALSE}
spk_bar <- exp_data %>%
  group_by(spk) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))

bar_spk <- ggplot(spk_bar, aes(y = mean)) +
  geom_bar(aes(x = spk, fill = spk), stat="identity", alpha=0.7) +
  geom_errorbar(aes(x = spk, 
                    ymin=mean-ic, 
                    ymax=mean+ic), width=0.4, colour="black", alpha=0.9) + 
  ylab("Masculinity Rating") +
  xlab("Speaker ID") +
  scale_fill_manual(values = cbPalette_2, name = "Speaker")
print(bar_spk)
ggsave(file="./analysis/main/Graphs/bar_spk.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/bar_spk.png",width=6,height=4)
```

### Ratings by sib_code
```{r sib_bar, echo=FALSE}
sib_bar <- exp_data %>%
  group_by(sib_code) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))

bar_sib <- ggplot(sib_bar, aes(y = mean)) +
  geom_bar(aes(x = sib_code, fill = sib_code), stat="identity", alpha=0.7) +
  geom_errorbar(aes(x = sib_code, 
                    ymin=mean-ic, 
                    ymax=mean+ic), width=0.4, colour="black", alpha=0.9) + 
  ylab("Masculinity Rating") +
  xlab("Sibilant Condition") +
  scale_fill_manual(values = cbPalette, name = "Sibilant Condition")
print(bar_sib)
ggsave(file="./analysis/main/Graphs/bar_sib.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/bar_sib.png",width=6,height=4)
```

### Ratings by speaker and sibilant
```{r spk_sib_bar, echo=FALSE}
exp_data_spk_sib <- exp_data %>%
  group_by(sib_code,spk) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))

bar_sib_spk <- ggplot(exp_data_spk_sib, aes(x = spk, y = mean, fill = sib_code)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("Masculinity Rating") +
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette, name = "Sibilant Condition")
print(bar_sib_spk)
ggsave(file="./analysis/main/Graphs/bar_sib_spk.pdf",width=8,height=5)
ggsave(file="./analysis/main/Graphs/bar_sib_spk.png",width=8,height=5)
```
### SRQ
```{r srq}
ggplot(exp_data, aes(y = response_numeric/100, 
                          x = srq_score)) + 
  stat_summary(aes(group = spk,
                   color = spk),
               fun = "mean",
               geom = "pointrange",
               alpha = .5) +
  xlab("Participant SRQ Score") +
  ylab("Mean Masculinity Rating") + 
  facet_wrap(~spk) +
  geom_smooth(method = "lm",
              se = T,
              color = "black") +
  scale_color_manual(values = cbPalette_2, name = "Speaker")

ggplot(exp_data, aes(y = response_numeric/100, 
                          x = srq_score)) + 
  stat_summary(aes(group = sib_code),
               fun = "mean",
               geom = "pointrange",
               alpha = .5) +
  xlab("Participant SRQ Score") +
  ylab("Mean Masculinity Rating") + 
  facet_wrap(~sib_code) +
  geom_smooth(method = "lm",
              se = T,
              color = "red") 

ggplot(exp_data, aes(y = response_numeric/100, 
                          x = srq_score)) + 
  stat_summary(aes(group = sib_code),
               fun = "mean",
               geom = "pointrange",
               alpha = .25) +
  xlab("Participant SRQ Score") +
  ylab("Mean Masculinity Rating") + 
  facet_wrap(spk~sib_code) +
  geom_smooth(method = "lm",
              se = T,
              color = "red") +
  scale_color_manual(values = cbPalette, name = "Sibilant Condition")
```

### Phonetics
#### Speaker summaries (Accounting for creak)
```{r spk_sum}
exp_data$NC_range_semi <- exp_data$NC_pitMax_semi- exp_data$NC_pitMin_semi
exp_data$NC_range_Hz <- exp_data$NC_pitMax_Hz - exp_data$NC_pitMin_Hz
#exp_data$spk <- relevel(exp_data$spk, ref = "A")

df_no_control <- subset.data.frame(exp_data, sib_code != "control")
#df_no_control$spk <- relevel(df_no_control$spk, ref = "A")
df_no_control$sib_code <- relevel(df_no_control$sib_code, ref = "backed")

exp_summary_phon <- df_no_control %>% group_by(spk) %>% summarize("avg_f0_Hz"=mean(NC_pitAve_Hz), "avg_f0_semi"=mean(NC_pitAve_semi), "avg_f0_range_Hz" = mean(NC_range_Hz), "avg_f0_range_semi" = mean(NC_range_semi), "s_dur_ms" = mean(s_milliseconddur, na.rm = T), "avg_creak_prop" = mean(prop_creak), "avg_speech_rate" = mean(speech_rate)) 

print(exp_summary_phon)

violin_sib_mean_pitch <- ggplot(df_no_control, aes(x = spk, y = NC_pitAve_semi))+
  geom_violin(aes(fill=spk))+
  ylab("Mean F0 (Semitones, rel. 100 Hz)")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(violin_sib_mean_pitch)
ggsave(file="./analysis/main/Graphs/violin_sib_mean_pitch.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/violin_sib_mean_pitch.png",width=6,height=4)

violin_sib_var_pitch <- ggplot(df_no_control, aes(x = spk, y = NC_range_semi))+
  geom_violin(aes(fill=spk))+
  ylab("F0 Range (Semitones, rel. 100 Hz)")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(violin_sib_var_pitch)
ggsave(file="./analysis/main/Graphs/violin_sib_var_pitch.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/violin_sib_var_pitch.png",width=6,height=4)

violin_creak <- ggplot(df_no_control, aes(x = spk, y = prop_creak))+
  geom_violin(aes(fill=spk))+
  ylab("Proportion of Creak in Utterance")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(violin_creak)
ggsave(file="./analysis/main/Graphs/violin_creak.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/violin_creak.png",width=6,height=4)

box_sib_mean_pitch <- ggplot(df_no_control, aes(x = spk, y = NC_pitAve_semi))+
  geom_boxplot(aes(fill=spk))+
  ylab("Mean F0 (Semitones, rel. 100 Hz)")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(box_sib_mean_pitch)
ggsave(file="./analysis/main/Graphs/box_sib_mean_pitch.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/box_sib_mean_pitch.png",width=6,height=4)

box_sib_var_pitch <- ggplot(df_no_control, aes(x = spk, y = NC_range_semi))+
  geom_boxplot(aes(fill=spk))+
  ylab("F0 Range (Semitones, rel. 100 Hz)")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(box_sib_var_pitch)
ggsave(file="./analysis/main/Graphs/box_sib_var_pitch.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/box_sib_var_pitch.png",width=6,height=4)

box_creak <- ggplot(df_no_control, aes(x = spk, y = prop_creak))+
  geom_boxplot(aes(fill=spk))+
  ylab("Proportion of Creak in Utterance")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(box_creak)
ggsave(file="./analysis/main/Graphs/box_creak.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/box_creak.png",width=6,height=4)

box_rate <- ggplot(df_no_control, aes(x = spk, y = speech_rate))+
  geom_boxplot(aes(fill=spk))+
  ylab("Speech Rate (Syllables/Sec)")+
  xlab("Speaker") +
  scale_fill_manual(values = cbPalette_2) 
print(box_rate)
ggsave(file="./analysis/main/Graphs/box_rate.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/box_rate.png",width=6,height=4)
```

#### Raw pitch measurements 

```{r raw_pitch, echo=FALSE}
smooth_pitch_Hz <- ggplot(exp_data,aes(x = pitAve_Hz, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Mean Pitch (Hz)") + 
  scale_color_manual(values=cbPalette, name = "Sibilant Condition") 
print(smooth_pitch_Hz)
ggsave(file="./analysis/main/Graphs/smooth_pitch_Hz.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_pitch_Hz.png",width=6,height=4)

smooth_pitch_semi <- ggplot(exp_data,aes(x = pitAve_semi, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Mean Pitch (semitones)") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_pitch_semi)
ggsave(file="./analysis/main/Graphs/smooth_pitch_semi.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_pitch_semi.png",width=6,height=4)

smooth_sd_pitch_Hz <- ggplot(exp_data,aes(x = pitSD_Hz, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch SD (Hz)") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_sd_pitch_Hz)
ggsave(file="./analysis/main/Graphs/smooth_sd_pitch_Hz.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_sd_pitch_Hz.png",width=6,height=4)

smooth_sd_pitch_semi <- ggplot(exp_data,aes(x = pitSD_semi, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch SD (semitones)") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_sd_pitch_semi)
ggsave(file="./analysis/main/Graphs/smooth_sd_pitch_semi.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_sd_pitch_semi.png",width=6,height=4)

smooth_range_pitch_Hz <- ggplot(exp_data,aes(x = (pitMax_Hz - pitMin_Hz), y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch Range (Hz)") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_range_pitch_Hz)
ggsave(file="./analysis/main/Graphs/smooth_range_pitch_Hz.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_range_pitch_Hz.png",width=6,height=4)

smooth_range_pitch_semi <- ggplot(exp_data,aes(x = (pitMax_semi - pitMin_semi), y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch Range (semitones)") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_range_pitch_semi)
ggsave(file="./analysis/main/Graphs/smooth_range_pitch_semi.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_range_pitch_semi.png",width=6,height=4)

ggplot(df_no_control, aes(y = response_numeric/100, 
                          x =(norm_max_f0 - norm_min_f0) )) + 
  stat_summary(aes(group = sib_code,
                   color = sib_code),
               fun = "mean",
               geom = "pointrange",
               alpha = .5) +
  xlab("Pitch Range (semitones)") +
  ylab("Speaker Masculinity Rating") + 
  facet_wrap(~spk) +
  geom_smooth(method = "lm",
              se = T,
              color = "black") +
  scale_color_manual(values = cbPalette_3, name = "Sibilant Condition")
ggsave(file="./analysis/main/Graphs/pit_range_point.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/pit_range_point.png",width=6,height=4)

ggplot(df_no_control, aes(y = response_numeric/100, 
                          x =norm_mean_f0)) + 
  stat_summary(aes(group = sib_code,
                   color = sib_code),
               fun = "mean",
               geom = "pointrange",
               alpha = .5) +
  xlab("Mean Pitch (Semitones, rel. 100 Hz)") +
  ylab("Masculinity Rating") + 
  facet_wrap(~spk) +
  geom_smooth(method = "lm",
              se = T,
              color = "black") +
  scale_color_manual(values = cbPalette_3, name = "Sibilant Condition")
ggsave(file="./analysis/main/Graphs/pit_ave_point.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/pit_ave_point.png",width=6,height=4)
```
#### No-creak pitch measurements 

```{r NC_pitch, echo=FALSE}
smooth_nc_pitch_Hz <- ggplot(exp_data,aes(x = NC_pitAve_Hz, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Mean Pitch (Hz) - Creak Excluded") + 
  scale_color_manual(values=cbPalette, name = "Sibilant Condition") 
print(smooth_nc_pitch_Hz)
ggsave(file="./analysis/main/Graphs/smooth_nc_pitch_Hz.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_nc_pitch_Hz.png",width=6,height=4)

point_nc_pitch_Hz <- ggplot(exp_data, aes(x = NC_pitAve_Hz, y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(.~sib_code) + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(point_nc_pitch_Hz)

smooth_nc_pitch_semi <- ggplot(exp_data,aes(x = NC_pitAve_semi, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Mean Pitch (semitones) - Creak Excluded") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_nc_pitch_semi)
ggsave(file="./analysis/main/Graphs/smooth_nc_pitch_semi.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_nc_pitch_semi.png",width=6,height=4)

point_nc_pitch_semi <- ggplot(exp_data, aes(x = NC_pitAve_semi, y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(.~sib_code) + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(point_nc_pitch_semi)

smooth_sd_nc_pitch_Hz <- ggplot(exp_data,aes(x = NC_pitSD_Hz, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch SD (Hz) - Creak Excluded") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_sd_nc_pitch_Hz)
ggsave(file="./analysis/main/Graphs/smooth_sd_nc_pitch_Hz.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_sd_nc_pitch_Hz.png",width=6,height=4)

point_sd_nc_pitch_Hz <- ggplot(exp_data, aes(x =NC_pitSD_Hz, y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(.~sib_code) + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(point_sd_nc_pitch_Hz)

smooth_sd_nc_pitch_semi <- ggplot(exp_data,aes(x = NC_pitSD_semi, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch SD (semitones) - Creak Excluded") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_sd_nc_pitch_semi)
ggsave(file="./analysis/main/Graphs/smooth_sd_nc_pitch_semi.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_sd_nc_pitch_semi.png",width=6,height=4)

point_sd_nc_pitch_semi <- ggplot(exp_data, aes(x =NC_pitSD_semi, y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(.~sib_code) + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(point_sd_nc_pitch_semi)

smooth_range_nc_pitch_Hz <- ggplot(exp_data,aes(x = (NC_pitMax_Hz - NC_pitMin_Hz), y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch Range (Hz) - Creak Excluded") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_range_nc_pitch_Hz)
ggsave(file="./analysis/main/Graphs/smooth_range_nc_pitch_Hz.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_range_nc_pitch_Hz.png",width=6,height=4)

point_range_nc_pitch_Hz <- ggplot(exp_data, aes(x =(NC_pitMax_Hz - NC_pitMin_Hz), y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(.~sib_code) + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(point_range_nc_pitch_Hz)

smooth_range_nc_pitch_semi <- ggplot(exp_data,aes(x = (NC_pitMax_semi - NC_pitMin_semi), y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Pitch Range (semitones) - Creak Excluded") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(smooth_range_nc_pitch_semi)
ggsave(file="./analysis/main/Graphs/smooth_range_nc_pitch_semi.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_range_nc_pitch_semi.png",width=6,height=4)

point_range_nc_pitch_semi <- ggplot(exp_data, aes(x =(NC_pitMax_semi - NC_pitMin_semi), y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(.~sib_code) + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(point_range_nc_pitch_semi)
```

#### Role of creak

At first, it appears like creak plays a large role in predicting masculinity rating, but this perceived effect diminishes when accounting for things like speaker ID and sibilant condition.   

```{r creak_bar, echo=FALSE}
exp_data_creak <- filter(exp_data) %>%
  group_by(creak) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))
bar_all_by_creak <- ggplot(exp_data_creak, aes(x = creak, y = mean)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("Masculinity Rating") +
  xlab("Creak Present?") 
ggsave(file="./analysis/main/Graphs/bar_all_by_creak.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/bar_all_by_creak.png",width=6,height=4)
print(bar_all_by_creak)

exp_data_creak_spk <- filter(exp_data) %>%
  group_by(spk,creak) %>%
  summarise( 
    n=n(),
    mean=mean(response_numeric/100),
    sd=sd(response_numeric/100)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))
bar_by_spk_creak <- ggplot(exp_data_creak_spk, aes(x = spk, y = mean, fill = creak)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("Masculinity Rating") +
  xlab("Speaker") + 
  scale_fill_manual(values = c("red","lightgreen"), name = "Creak Present?")
ggsave(file="./analysis/main/Graphs/bar_by_spk_creak.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/bar_by_spk_creak.png",width=6,height=4)
print(bar_by_spk_creak)

smooth_creak <- ggplot(exp_data,aes(x = prop_creak, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("Proportion of Creak within Utterance") + 
  scale_color_manual(values=cbPalette, name = "Sibilant Condition") 
print(smooth_creak)
ggsave(file="./analysis/main/Graphs/smooth_creak.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/smooth_creak.png",width=6,height=4)

smooth_creak_point <- ggplot(exp_data, aes(x =prop_creak, y = response_numeric/100)) + 
  geom_point() + 
  facet_grid(~spk) +
  geom_smooth(method = "lm", aes()) + 
  ylab("Masculinity Rating") +
  xlab("Proportion of Creak within Utterance")
print(smooth_creak_point)

df_no_control <- subset.data.frame(exp_data, sib_code != "control")
df_no_control$spk <- relevel(df_no_control$spk, ref = "A")
df_no_control$sib_code <- relevel(df_no_control$sib_code, ref = "backed")
ggplot(df_no_control, aes(y = response_numeric/100, 
                          x = prop_creak)) + 
  stat_summary(aes(group = sib_code,
                   color = sib_code),
               fun = "mean",
               geom = "pointrange",
               alpha = .5) +
  xlab("Proportion Creak") +
  ylab("Masculinity Rating") + 
  facet_wrap(~spk) +
  geom_smooth(method = "lm",
              se = T,
              color = "black") +
  scale_color_manual(values = cbPalette_3, name = "Sibilant Condition")
ggsave(file="./analysis/main/Graphs/prop_creak_point.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/prop_creak_point.png",width=6,height=4)

```

#### Sibilant Duration

```{r sib_dur, echo = FALSE}
sib_dur <- ggplot(exp_data,aes(x = s_milliseconddur, y = response_numeric/100))+
  geom_smooth(aes(colour=sib_code))+ 
  ylab("Masculinity Rating") +
  xlab("/s/ Duration (ms)") +
  scale_color_manual("Sibilant Condition", values=cbPalette) 
print(sib_dur)
ggsave(file="./analysis/main/Graphs/sib_dur.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/sib_dur.png",width=6,height=4)

sib_dur_point <- ggplot(exp_data, aes(x =s_milliseconddur, y = response_numeric/100)) + 
  geom_point() + 
  geom_smooth(method = "lm", aes(color = sib_code))
print(sib_dur_point)

exp_data_sdur <- filter(exp_data) %>% filter(!is.na(s_milliseconddur)) %>%
  group_by(spk) %>%
  summarise( 
    n=n(),
    mean=mean(s_milliseconddur),
    sd=sd(s_milliseconddur)
  ) %>%
  mutate( se=sd/sqrt(n))  %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))

bar_by_sdur <- ggplot(exp_data_sdur, aes(x = spk, y = mean)) +
  stat_summary(fun = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin=mean-ic, 
                    ymax=mean+ic), width=0.3, position = position_dodge(width = .9)) + 
  ylab("/s/ Duration (ms)") +
  xlab("Speaker") 
#ggsave(file="./analysis/main/Graphs/bar_by_sdur.pdf",width=6,height=4)
#ggsave(file="./analysis/main/Graphs/bar_by_sdur.png",width=6,height=4)
print(bar_by_sdur)

sib_dur_box <- ggplot(exp_data, aes(x =spk, y = s_milliseconddur)) + 
  geom_boxplot() 
print(sib_dur_box)


```

#### Raw F2
```{r f2, echo=FALSE}
df_no_control <- subset.data.frame(exp_data, sib_code != "control")
df_no_control$spk <- as.factor(df_no_control$spk)
df_no_control$spk <- relevel(df_no_control$spk, ref = "A")
df_no_control$sib_code <- relevel(df_no_control$sib_code, ref = "backed")

box_f2 <- ggplot(df_no_control, aes(x = spk, y = f2_raw))+
  geom_point(aes(color=spk),
             position = position_dodge())+
  ylab("Raw F2")+
  xlab("Speaker") +
  facet_wrap(~vowel) +
  scale_fill_manual(values = cbPalette_2) 
print(box_f2)

resp_by_f2 <- ggplot(exp_data, aes(x = response_numeric/100, y = f2_raw)) + 
  geom_point(aes(colour =spk)) + 
  ylab("Raw F2") +
  xlab("Speaker Masculinity Rating") + 
  scale_color_manual(values = cbPalette)
print(resp_by_f2)

resp_by_f2_v2 <- ggplot(df_no_control, aes(y = response_numeric/100, 
                          x = f2_raw)) + 
  stat_summary(aes(group = spk,
                   color = spk),
               fun = "mean",
               geom = "pointrange",
               alpha = .5) +
  xlab("Raw F2") +
  ylab("Masculinity Rating") + 
  facet_wrap(spk~sib_code) +
  geom_smooth(method = "lm",
              se = T,
              color = "black") #+
  #scale_color_manual(values = cbPalette_3, name = "Sibilant Condition")
ggsave(file="./analysis/main/Graphs/df_no_control.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/df_no_control.png",width=6,height=4)
print(resp_by_f2_v2)
```

## Modeling

```{r factors, echo=FALSE}
exp_data$triplet_id <- as.factor(exp_data$triplet_id)
exp_data$spk <- as.factor(exp_data$spk)
exp_data$spk <- relevel(exp_data$spk, ref = "B")
exp_data$workerid <- as.factor(exp_data$workerid)
exp_data$score_link <- as.numeric(exp_data$score_link)
exp_data$score_trans <- as.numeric(exp_data$score_trans)
exp_data$sib_code <- relevel(exp_data$sib_code, ref = "mid")
exp_data$political <- as.factor(exp_data$political)
exp_data$political <- relevel(exp_data$political, ref = "2")
exp_data$response_numeric <- exp_data$response_numeric/100
exp_data$NC_range_semi <- exp_data$NC_pitMax_semi- exp_data$NC_pitMin_semi
exp_data$srq_scoreC <- exp_data$srq_score - mean(exp_data$srq_score)
exp_data$region <- as.factor(exp_data$region)
exp_data$region <- relevel(exp_data$region, ref = "Southeast - AL, AR, FL, GA, KY, LA, MS, NC, SC, TN, VA, WV")
exp_data$political <- as.factor(exp_data$political)
exp_data$political <- relevel(exp_data$political, ref = "2")
exp_data$education <- as.factor(exp_data$education)
exp_data$education <- relevel(exp_data$education, ref = "Graduated college")

## for post-hoc analysis
exp_data$NC_norm_mean_f0C <- exp_data$NC_norm_mean_f0 - mean(exp_data$NC_norm_mean_f0)
exp_data$NC_norm_range_f0 <- exp_data$NC_norm_max_f0 - exp_data$NC_norm_min_f0 
exp_data$NC_norm_range_f0C <- exp_data$NC_norm_range_f0 - mean(exp_data$NC_norm_range_f0)
exp_data$prop_creakC <- exp_data$prop_creak - mean(exp_data$prop_creak)
exp_data$speech_rateC <- exp_data$speech_rate - mean(exp_data$speech_rate)
exp_data$ageC <- exp_data$age - mean(exp_data$age)

subset <- exp_data %>% filter(sib_code != "control")
```


### Full ling model
```{r full ling model}
model_planned <- lmer(response_numeric ~ sib_code*spk + 
                        prop_creakC + 
                        speech_rateC + 
                        NC_norm_mean_f0C + 
                        NC_norm_range_f0C +
                        f2_raw*sib_code +
                        gender*spk + ageC*spk + 
                        srq_scoreC*spk + # original model used score_trans
                        (1|workerid) + (1|triplet_id), data = exp_data, REML = F)
summary(model_planned)

r.squaredGLMM(model_planned)

model_planned_sub <- lmer(response_numeric ~ sib_code*spk + 
                        prop_creakC + 
                        speech_rateC + 
                        NC_norm_mean_f0C + 
                        NC_norm_range_f0C +
                        f2_raw*sib_code +
                        gender*spk + ageC*spk + 
                        srq_scoreC*spk + # original model used score_trans
                        (1|workerid) + (1|triplet_id), data = subset, REML = F)
summary(model_planned_sub)

r.squaredGLMM(model_planned_sub)
```
```{r demo factor graphs}
demo_adj <- exp_data
demo_adj$spk <- relevel(demo_adj$spk, ref = "A")
demo_adj <- subset.data.frame(demo_adj, gender != "Other")
demo_gender <- ggplot(data = demo_adj, 
       mapping = aes(x = spk,
                     y = response_numeric,
                     group = gender,
                     fill = gender)) + 
  stat_summary(fun = "mean",
               geom = "bar",
               position = position_dodge(.9)) + 
  stat_summary(fun.data = "mean_cl_boot",
               geom = "linerange",
               position = position_dodge(.9)) +
  xlab("Speaker ID") +
  ylab("Mean Masculinity Rating") + 
  scale_fill_manual(values = cbPalette, name = "Listener Gender")
ggsave(file="./analysis/main/Graphs/demo_gender.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/demo_gender.png",width=6,height=4)
print(demo_gender)

demo_age <- ggplot(data = demo_adj,
       mapping = aes(x = age,
                     y = response_numeric,
                     group = spk,
                     color = spk)) + 
  stat_summary(fun = "mean",
               geom = "pointrange",
               alpha = .6) + 
  geom_smooth(method = "lm",
              se = T) + 
  xlab("Listener Age") +
  ylab("Mean Masculinity Rating") + 
  scale_color_manual(values = cbPalette_2, name = "Speaker ID")
ggsave(file="./analysis/main/Graphs/demo_age.pdf",width=6,height=4)
ggsave(file="./analysis/main/Graphs/demo_age.png",width=6,height=4)
print(demo_age)
```

```{r pairwise_full}
emmeans(model_planned_sub, pairwise ~ sib_code | spk, lmerTest.limit = 29499)
emmeans(model_planned_sub, pairwise ~ sib_code, lmerTest.limit = 29499)
emmeans(model_planned_sub, pairwise ~ spk, lmerTest.limit = 29499)
```

### Simple Model
```{r model_simple}
## simple model, no control
model_simple_sub <- lmer(response_numeric ~ sib_code*spk + 
                           gender*spk + ageC*spk + srq_scoreC*spk +
                           (1|workerid) + (1|triplet_id), data = subset, REML = F)
summary(model_simple_sub)

r.squaredGLMM(model_simple_sub)

## simple model with control 
model_simple <- lmer(response_numeric ~ sib_code*spk + 
                           gender*spk + ageC*spk + srq_scoreC*spk +
                           (1 + sib_code || workerid) + (1|triplet_id), data = exp_data, REML = F)
summary(model_simple)

r.squaredGLMM(model_simple)

```

```{r pairwise_simple}
emmeans(model_simple_sub, pairwise ~ sib_code | spk, lmerTest.limit = 29499)
emmeans(model_simple, pairwise ~ sib_code, lmerTest.limit = 29499)
emmeans(model_simple, pairwise ~ spk, lmerTest.limit = 29499)
```

### Model Comparisons (Simple vs Full Ling Models)
```{r compare}
AIC(model_planned_sub, model_simple_sub)
```
